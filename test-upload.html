<!DOCTYPE html>
<html>
<head>
    <title>Upload Test</title>
</head>
<body>
    <h1>Upload Test</h1>
    <p><strong>Note:</strong> In production, userId should come from authenticated SSO session.</p>
    <input type="text" id="userIdInput" placeholder="Enter userId (from SSO)" value="your-authenticated-user-id" style="width: 300px; margin-bottom: 10px;" />
    <br>
    <input type="file" id="fileInput" />
    <button onclick="testUpload()">Test Upload</button>
    <div id="result"></div>

    <script>
        async function testUpload() {
            const fileInput = document.getElementById('fileInput');
            const userIdInput = document.getElementById('userIdInput');
            const file = fileInput.files[0];
            const userId = userIdInput.value;
            
            if (!file) {
                alert('Please select a file');
                return;
            }

            if (!userId || userId === 'your-authenticated-user-id') {
                alert('Please enter a valid userId (in production this comes from SSO authentication)');
                return;
            }

            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Uploading...';

            try {
                // Test base64 approach
                const arrayBuffer = await file.arrayBuffer();
                const base64 = btoa(String.fromCharCode(...new Uint8Array(arrayBuffer)));
                
                const payload = {
                    userId: userId, // Dynamic userId from input (mimics SSO authentication)
                    parentId: 'ROOT',
                    fileData: base64,
                    fileName: file.name,
                    mimeType: file.type,
                    size: file.size
                };

                console.log('Payload:', payload);

                const response = await fetch('http://localhost:5001/drive/upload', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', Object.fromEntries(response.headers.entries()));

                const responseText = await response.text();
                console.log('Response text:', responseText);

                if (response.ok) {
                    resultDiv.innerHTML = 'Upload successful: ' + responseText;
                } else {
                    resultDiv.innerHTML = 'Upload failed: ' + response.status + ' ' + responseText;
                }
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>

